<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Liquid Glass Quiz App</title>
    <!-- Tailwind CSS CDN for utility classes -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            /* Background image and styling for the liquid glass effect */
            background-image: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQIizj-yKMa30aivqh1AFZ3YLdMf-VSphh8mg&s');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-blend-mode: overlay;
            background-color: rgba(0, 0, 0, 0.3);
            overflow: hidden; /* Prevent scrollbars */
        }

        .liquid-glass-container {
            background: rgba(255, 255, 255, 0.08); /* Slightly more transparent */
            backdrop-filter: blur(25px) saturate(200%); /* Stronger blur and saturation */
            -webkit-backdrop-filter: blur(25px) saturate(200%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.15), inset 0 0 10px rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 600px; /* Increased max-width for quiz content */
            text-align: center;
            color: #ffffff;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease-in-out;
        }

        .liquid-glass-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at var(--mouse-x, 50%) var(--mouse-y, 50%), rgba(255, 255, 255, 0.15) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease-out;
            pointer-events: none;
        }

        .liquid-glass-container:hover::before {
            opacity: 1;
        }

        .liquid-glass-button {
            background: rgba(255, 255, 255, 0.18);
            backdrop-filter: blur(12px) saturate(170%);
            -webkit-backdrop-filter: blur(12px) saturate(170%);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2), inset 0 0 8px rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 12px 25px;
            margin-top: 15px; /* Adjusted margin for option buttons */
            color: #ffffff;
            font-weight: 600;
            cursor: pointer;
            outline: none;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 100%; /* Make buttons full width */
            text-align: left; /* Align text left within button */
            padding-left: 20px;
        }

        .liquid-glass-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .liquid-glass-button:active {
            transform: translateY(0) scale(0.98);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        /* Input field styling */
        .liquid-glass-input {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px) saturate(150%);
            -webkit-backdrop-filter: blur(10px) saturate(150%);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 12px 20px;
            margin-bottom: 15px;
            color: #ffffff;
            font-weight: 400;
            outline: none;
            width: 100%;
            box-sizing: border-box; /* Include padding in width */
        }

        .liquid-glass-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        /* State for correct/incorrect answers */
        .liquid-glass-button.correct {
            background: rgba(144, 238, 144, 0.3); /* Light green */
            border-color: rgba(144, 238, 144, 0.5);
            box-shadow: 0 4px 15px rgba(0, 255, 0, 0.3), inset 0 0 8px rgba(255, 255, 255, 0.2);
            pointer-events: none; /* Disable after selection */
        }

        .liquid-glass-button.incorrect {
            background: rgba(255, 99, 71, 0.3); /* Tomato red */
            border-color: rgba(255, 99, 71, 0.5);
            box-shadow: 0 4px 15px rgba(255, 0, 0, 0.3), inset 0 0 8px rgba(255, 255, 255, 0.2);
            pointer-events: none; /* Disable after selection */
        }

        /* Ripple effect for buttons */
        .ripple {
            position: absolute;
            border-radius: 50%;
            transform: scale(0);
            animation: ripple-animation 0.6s linear;
            background-color: rgba(255, 255, 255, 0.7);
            opacity: 0;
        }

        @keyframes ripple-animation {
            from {
                transform: scale(0);
                opacity: 0.7;
            }
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #ffffff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive adjustments for mobile screens */
        @media (max-width: 640px) {
            .liquid-glass-container {
                padding: 15px; /* Reduced from 30px, roughly 50% */
                border-radius: 15px; /* Adjusted slightly */
                max-width: 95%; /* Ensure it fits narrow screens */
                margin: 10px; /* Add a small margin to the edges */
            }
            .liquid-glass-button {
                padding: 10px 15px; /* Reduced from 12px 25px */
                font-size: 0.8em; /* Adjusted for readability */
                margin-top: 10px; /* Adjusted margin */
            }
            .liquid-glass-input {
                padding: 10px 15px; /* Reduced from 12px 20px */
                font-size: 0.8em; /* Adjusted for readability */
            }
            #appHeader {
                font-size: 2rem; /* Adjusted for mobile header size */
                margin-bottom: 15px; /* Adjusted margin */
            }
            #questionDisplay {
                font-size: 1.1rem; /* Adjusted for mobile question size */
                margin-bottom: 15px; /* Adjusted margin */
            }
            #scoreDisplay {
                font-size: 1.2rem; /* Adjusted for mobile score size */
            }
        }
    </style>
</head>
<body>
    <div class="liquid-glass-container" id="quizContainer">
        <!-- Dynamic header for the app -->
        <div id="appHeader" class="text-3xl md:text-4xl font-bold mb-4 flex items-center justify-center gap-2">
            <!-- Content will be set by JavaScript -->
        </div>

        <!-- Initial setup for quiz generation -->
        <div id="quizSetup" class="p-4">
            <label for="quizTopic" class="block text-xl mb-2">What kind of quiz do you want?</label>
            <input type="text" id="quizTopic" placeholder="e.g., History, Science, Pop Culture" class="liquid-glass-input mb-4">

            <label for="numOptions" class="block text-xl mb-2">How many options per question?</label>
            <input type="number" id="numOptions" value="4" min="2" max="6" class="liquid-glass-input mb-4">

            <button class="liquid-glass-button w-auto px-8" id="generateQuizBtn">
                Generate Quiz
            </button>
        </div>

        <!-- Quiz display area -->
        <div id="quizContent" style="display:none;">
            <div id="questionDisplay" class="text-xl md:text-2xl mb-6">
                <!-- Question will be loaded here -->
            </div>
            <div id="optionsContainer" class="flex flex-col gap-4">
                <!-- Options will be loaded here -->
            </div>
            <button class="liquid-glass-button mt-6 w-auto px-8" id="nextButton" style="display:none;">
                Next Question
            </button>
            <button class="liquid-glass-button mt-6 w-auto px-8" id="restartButton" style="display:none;">
                New Quiz
            </button>
            <div id="scoreDisplay" class="text-2xl mt-6" style="display:none;">
                <!-- Score will be displayed here -->
            </div>
        </div>

        <!-- Loading spinner -->
        <div id="loadingSpinner" class="spinner" style="display:none;"></div>
        <div id="errorMessage" class="text-red-400 mt-4" style="display:none;"></div>
    </div>

    <script>
        const quizContainer = document.getElementById('quizContainer');
        const appHeader = document.getElementById('appHeader'); // New header element
        const quizSetup = document.getElementById('quizSetup');
        const quizTopicInput = document.getElementById('quizTopic');
        const numOptionsInput = document.getElementById('numOptions');
        const generateQuizBtn = document.getElementById('generateQuizBtn');
        const quizContent = document.getElementById('quizContent');
        const questionDisplay = document.getElementById('questionDisplay');
        const optionsContainer = document.getElementById('optionsContainer');
        const nextButton = document.getElementById('nextButton');
        const restartButton = document.getElementById('restartButton');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const errorMessage = document.getElementById('errorMessage');

        let quizQuestions = []; // This will store AI-generated questions
        let currentQuestionIndex = 0;
        let score = 0;
        let answerSelected = false;

        // Function to update CSS variables for mouse position
        function updateMousePosition(e) {
            const rect = quizContainer.getBoundingClientRect();
            const x = (e.clientX - rect.left) / rect.width * 100;
            const y = (e.clientY - rect.top) / rect.height * 100;
            quizContainer.style.setProperty('--mouse-x', `${x}%`);
            quizContainer.style.setProperty('--mouse-y', `${y}%`);
        }

        // Add event listener for mouse movement on the quiz container
        quizContainer.addEventListener('mousemove', updateMousePosition);

        // Reset mouse position when mouse leaves the quiz container
        quizContainer.addEventListener('mouseleave', () => {
            quizContainer.style.setProperty('--mouse-x', `50%`);
            quizContainer.style.setProperty('--mouse-y', `50%`);
        });

        // Function to create ripple effect on buttons
        function createRipple(event) {
            const button = event.currentTarget;
            const circle = document.createElement('span');
            const diameter = Math.max(button.clientWidth, button.clientHeight);
            const radius = diameter / 2;

            circle.style.width = circle.style.height = `${diameter}px`;
            circle.style.left = `${event.clientX - (button.getBoundingClientRect().left + radius)}px`;
            circle.style.top = `${event.clientY - (button.getBoundingClientRect().top + radius)}px`;
            circle.classList.add('ripple');

            // Remove existing ripple if any
            const existingRipple = button.getElementsByClassName('ripple')[0];
            if (existingRipple) {
                existingRipple.remove();
            }

            button.appendChild(circle);
        }

        // Function to update the app header
        function updateAppHeader(text, iconHtml = '') {
            appHeader.innerHTML = iconHtml + text;
        }

        // Function to generate quiz questions using Gemini API
        async function generateQuiz() {
            const topic = quizTopicInput.value.trim();
            const numOptions = parseInt(numOptionsInput.value, 10);

            if (!topic) {
                errorMessage.textContent = "Please enter a quiz topic.";
                errorMessage.style.display = 'block';
                return;
            }
            if (isNaN(numOptions) || numOptions < 2 || numOptions > 6) {
                errorMessage.textContent = "Number of options must be between 2 and 6.";
                errorMessage.style.display = 'block';
                return;
            }

            errorMessage.style.display = 'none';
            quizSetup.style.display = 'none';
            loadingSpinner.style.display = 'block';
            quizContent.style.display = 'none';
            updateAppHeader('Generating your quiz...');

            try {
                // Prompt for the AI model
                const prompt = `Generate a JSON array of 5 multiple-choice quiz questions about "${topic}". Each question should have ${numOptions} options, and one correct answer. The JSON should be structured as follows:
                [
                    {
                        "question": "Your question here?",
                        "options": ["Option A", "Option B", "Option C", "Option D"],
                        "answer": "Correct Option Text"
                    },
                    ...
                ]`;

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = {
                    contents: chatHistory,
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "ARRAY",
                            items: {
                                type: "OBJECT",
                                properties: {
                                    "question": { "type": "STRING" },
                                    "options": {
                                        type: "ARRAY",
                                        items: { "type": "STRING" }
                                    },
                                    "answer": { "type": "STRING" }
                                },
                                "propertyOrdering": ["question", "options", "answer"]
                            }
                        }
                    }
                };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const jsonString = result.candidates[0].content.parts[0].text;
                    quizQuestions = JSON.parse(jsonString);

                    // Basic validation of generated questions
                    if (!Array.isArray(quizQuestions) || quizQuestions.length === 0) {
                        throw new Error("AI did not generate a valid quiz array.");
                    }
                    for (const q of quizQuestions) {
                        if (!q.question || !Array.isArray(q.options) || q.options.length !== numOptions || !q.answer) {
                            throw new Error("Invalid quiz question format from AI.");
                        }
                        if (!q.options.includes(q.answer)) {
                            console.warn(`Correct answer "${q.answer}" not found in options for question: "${q.question}"`);
                            // Optionally, re-add the correct answer if missing, or handle as an error
                        }
                    }

                    currentQuestionIndex = 0;
                    score = 0;
                    quizContent.style.display = 'block';
                    loadQuestion();
                    updateAppHeader('Your Quiz Awaits!');
                } else {
                    throw new Error("No valid content received from AI.");
                }
            } catch (error) {
                console.error("Error generating quiz:", error);
                errorMessage.textContent = `Failed to generate quiz: ${error.message}. Please try again.`;
                errorMessage.style.display = 'block';
                quizSetup.style.display = 'block'; // Show setup again on error
                updateAppHeader('AI Quiz Generator');
            } finally {
                loadingSpinner.style.display = 'none';
            }
        }

        // Function to load a question
        function loadQuestion() {
            answerSelected = false;
            nextButton.style.display = 'none'; // Hide next button
            restartButton.style.display = 'none'; // Hide restart button
            scoreDisplay.style.display = 'none'; // Hide score display
            updateAppHeader(`Question ${currentQuestionIndex + 1}/${quizQuestions.length}`);


            if (currentQuestionIndex < quizQuestions.length) {
                const questionData = quizQuestions[currentQuestionIndex];
                questionDisplay.textContent = questionData.question;
                optionsContainer.innerHTML = ''; // Clear previous options

                questionData.options.forEach(option => {
                    const button = document.createElement('button');
                    button.classList.add('liquid-glass-button');
                    button.textContent = option;
                    button.addEventListener('click', (e) => selectAnswer(e, option, questionData.answer));
                    button.addEventListener('click', createRipple); // Add ripple effect
                    optionsContainer.appendChild(button);
                });
            } else {
                showScore(); // End of quiz
            }
        }

        // Function to handle answer selection
        function selectAnswer(event, selectedOption, correctAnswer) {
            if (answerSelected) return; // Prevent multiple selections

            answerSelected = true;
            const buttons = optionsContainer.querySelectorAll('.liquid-glass-button');
            buttons.forEach(button => {
                if (button.textContent === correctAnswer) {
                    button.classList.add('correct');
                } else if (button.textContent === selectedOption) {
                    button.classList.add('incorrect');
                }
                // Stop ripple on selection
                button.removeEventListener('click', createRipple);
                button.style.pointerEvents = 'none'; // Disable further clicks on options
            });

            if (selectedOption === correctAnswer) {
                score++;
            }

            nextButton.style.display = 'block'; // Show next button
        }

        // Function to move to the next question
        nextButton.addEventListener('click', () => {
            currentQuestionIndex++;
            loadQuestion();
        });

        // Function to show the final score
        function showScore() {
            questionDisplay.textContent = 'Quiz Completed!';
            optionsContainer.innerHTML = ''; // Clear options
            nextButton.style.display = 'none'; // Hide next button
            scoreDisplay.textContent = `You scored ${score} out of ${quizQuestions.length}.`;
            scoreDisplay.style.display = 'block'; // Show score
            restartButton.style.display = 'block'; // Show restart button
            updateAppHeader('Quiz Results');
        }

        // Function to restart the quiz (go back to topic selection)
        restartButton.addEventListener('click', () => {
            quizContent.style.display = 'none';
            quizSetup.style.display = 'block';
            quizTopicInput.value = ''; // Clear topic input
            numOptionsInput.value = '4'; // Reset options to default
            quizQuestions = []; // Clear questions
            updateAppHeader('AI Quiz Generator'); // Reset header
        });

        // Event listener for Generate Quiz button
        generateQuizBtn.addEventListener('click', createRipple); // Ripple effect for generate button
        generateQuizBtn.addEventListener('click', generateQuiz);

        // Initial header setup
        updateAppHeader('AI Quiz Generator');
    </script>
</body>
</html>
